#summary Keep a local gelbooru to browse your downloaded images.

_Thanks a lot to NobodX for his help with the commands system and Gelbooru._



= Introduction =
First of all, know that using commands can slow down huge batch downloads (a recent computer may need from 100ms to 1s more per image, which is very consequent).

_Note: in this wiki, I'll consider that you're using Windows. But on Linux & other OSes, it should be pretty the same (use the cp command instead of copy, LAMP (linux) / MAMP (mac) instead of WAMP, etc.)._



= Installing a local web server =

First, we're going to install WAMP, which contains everithing required to have a local web server.

 # Download the latest version of WampServer here (2.2e as I am writing this): [http://sourceforge.net/projects/wampserver/]
 # Install it somewhere that doesn’t requires admin rights to write into (for example, the default location c:\wamp)
 # At the end of the installation, the installer may ask for two things.
  # First, he will ask you what your favorite browser is. You can leave it to the default value which will be Internet Explorer, or change it to another browser (Firefox, Chrome, etc.).
  # Finally, he will ask some email settings. Leave the default values, you don’t care about that.
 # Now that WampServer is installed, you should see a little green W in your system tray, near the clock (you may need to expand the tray to see it).
 # Congratulations! You can visit your local server by going to [http://localhost/ here]!



= Installing Gelbooru =

 # Download the latest version of Gelbooru here (0.1.10 as I am writing this): [http://gelbooru.com/index.php?page=forum&s=view&id=99]
 # Extract it to the www directory in your WampServer installation folder. You can either extract it to a subfolder or not. If you extract it to a subfolder, the site’s url will be [http://localhost/subfolder/], and if you don’t it will only be [http://localhost/]. It’s your choice, but if you don’t create a subfolder, you must remember to remove all the files in your www folder first. For the end of this tutorial, I’ll consider that you are using the subfolder "gelbooru".
 # Create a folder named "1" in the "images" folder.
 # If you are using linux, give the "images", "images/1" and "thumbnails" folders writable permissions.
 # Then, go to [http://localhost/phpmyadmin/]. If you have to login, use "root" as username and "" as password (no password).
 # Then, go to the databases tab and create a database named "gelbooru" with an "utf8_unicode_ci" encoding.
   Once done, Go to the "SQL" tab, and put this query in the text area:
{{{
SET GLOBAL log_bin_trust_function_creators = 1;
}}}
   Click "Go".
 # Then, open the file "config.php" with a plain text editor (I don’t recommend using a WYSIWYG editor such as word).
   <table cellpadding="3"><tr><td border="2">*Replace the line*</td><td>*By*</td></tr><tr><td>`$mysql_pass = "test";`</td><td>`$mysql_pass = "";`</td></tr><tr><td>`$mysql_db = "asdf";`</td><td>`$mysql_db = "gelbooru";`</td></tr><tr><td>`$site_url = "http://127.0.0.1/branches/0.1.10/0.1.10/";`</td><td>`$site_url = "http://localhost/gelbooru";`</td></tr><tr><td>`$site_url3 = "Default Booru";`</td><td>`$site_url2 = $site_url3 = "Localbooru";`</td></tr></table>
   (you can change "Localbooru" to anything: it will be the name of the booru)
 # And finally add, just before the "?>" at the end of the file:
{{{
$lowerlimit = 20;
$no_cache = false;
$tag_count = 20;
$new_tag_list = 'iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii';
$new_user_list = 'iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii';
$new_cthreshold = 0;
$new_pthreshold = 0;
$new_my_tags = '';
error_reporting(0);
}}}
  You can of course change these values to whatever you want.
 # Go to [http://localhost/gelbooru/install/] and register your admin account.
 # If you don’t see any errors the installation went well! As the script suggests, you can now delete the c:\wamp\www\gelbooru\install folder.
 # Finally, go to phpMyAdmin, click on the "gelbooru" database on the left menu, then click on the "SQL" tab, and put this query in the text area:
{{{
ALTER TABLE `tag_index` ADD PRIMARY KEY (`tag`)
}}}
   Click "Go".
 # You can now access your booru by going here: [http://localhost/gelbooru/]
 # If you still run into errors after adding images, click on the WampServer icon on the system tray, go to "PHP > PHP settings" and uncheck "display errors".




= Grabber =

== 3.2.0 and higer ==
Launch Grabber, then open the options window and go to the "Commands" part. Set it to those values:

- Driver: "QMYSQL"

- Host: "localhost"

- User: "root"

- Password: "" (nothing)

- Database: "gelbooru"

- Start: "" (nothing)

- Image:
{{{
INSERT INTO posts(creation_date, hash, image, height, width, ext, rating, tags, directory, active_date) VALUES(NOW(), "%md5%", "%md5%.%ext%", %height%, %width%, ".%ext%", "%rating%", " %all% ", "1", "20110619");
}}}

- Tag:
{{{
NSERT INTO tag_index(tag, index_count) VALUES("%tag%", 1) ON DUPLICATE KEY UPDATE index_count = index_count+1;
}}}

- End:
{{{
UPDATE post_count SET pcount = (SELECT COUNT(*) FROM posts), last_update = (CURDATE() + 0) WHERE access_key = "posts";
}}}

Now, every time you save an image, a copy will be created in your local booru!

== Older versions ==
Launch Grabber, then open the options window and go to the "Commands" part. Set it to those values:

Initialization (note that the mysql version may vary)
{{{
"C:\wamp\bin\mysql\mysql5.5.8\bin\mysql.exe" --user=root --password= gelbooru
}}}
Image (with initialization)
{{{
INSERT INTO posts(creation_date, hash, image, height, width, ext, rating, tags, directory, active_date) VALUES(NOW(), "%md5%", "%md5%.%ext%", %height%, %width%, ".%ext%", "%rating%", " %all% ", "1", "20110619"); UPDATE post_count SET pcount=pcount+1 WHERE access_key="posts";
}}}
Tag (with initialization)
{{{
INSERT INTO tag_index(tag, index_count) VALUES("%tag%", 1) ON DUPLICATE KEY UPDATE index_count = index_count+1;
}}}
Image
{{{
C:\Windows\System32\cmd.exe /C copy "%path%" "C:\wamp\www\gelbooru\images\1\%md5%.%ext%"
}}}

Now, every time you save an image, a copy will be created in your local booru!



= Troobleshooting =

== Thumbnails ==

If you test, you'll see that it doesn't works totally. In fact, no thumbnail is generated when doing this. Just visit [http://localhost/gelbooru/thumbs_fix.php http://localhost/gelbooru/thumbs_fix.php] to fix this. Note that you must be logged in as administrator in gelbooru to do this.

== Searches with short tags ==

By default, the minimal size for tags is 4. You may want to change this behavior to allow the search of shorter tags (some popular tags are only one character long, such as "v").
To do this, open your "my.ini" file by clicking on the Wamp icon in the system tray, then "MySQL > my.ini".
Search for "[mysqld]" in the file, and just under, add "ft_min_word_len=1" on a new line (1 is to allow one character long tags, you can set it to whatever you want, by default it is 4). Same thing for "[myisamchk]".
The end of your file should now look like this (there can be minor differences):
{{{
[myisamchk]
ft_min_word_len=1
key_buffer = 20M
sort_buffer_size = 20M
read_buffer = 2M
write_buffer = 2M

[mysqlhotcopy]
interactive-timeout

[mysqld]
ft_min_word_len=1
port=3306
}}}
Then go to phpMyAdmin, in the "gelbooru" database, check all the tables and choose "Repair tables" in the list.