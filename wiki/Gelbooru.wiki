#summary Keep a local gelbooru to browse your downloaded images.

= Introduction =
First of all, know that using commands can slow down huge batch downloads (a recent computer should take from 100ms to 1s more per image, which is very consequent).

_Note: in this wiki, I'll consider that you're using Windows. But on Linux & other OSes, it should be pretty the same (use the cp command instead of copy, LAMP instead of WAMP, etc.)._



= Installing a local web server =

First, we're going to install WAMP, which contains everithing required to have a local web server.

Go [http://sourceforge.net/projects/wampserver/ here] and download the latest version of WAMP.

Then, install it: "Next", "I accept the agreement" > "Next", "Next", "Next", "Install". It will ask you for "PHP mail parameters". We don't care about them, so just leave the default values and click Next and launch WAMP.



= Installing Gelbooru =

So we have a working server installed. You can check that everything works visiting [http://127.0.0.1/ 127.0.0.1] or [http://localhost/ localhost].

Now, we must install Gelbooru. Go [http://gelbooru.com/index.php?page=forum&s=view&id=99 here] and download the latest version from the 0.1 branch (0.1.`*`).

Then, extract it to "C:\Program Files\Wamp\www\gelbooru". You must now configure it and create its database.

Go to [http://localhost/phpmyadmin/ http://localhost/phpmyadmin/]. Username: "root", password: "" (blank). Change the language if you want, then create a database named "gelbooru" with an "utf8_unicode_ci" Collation.

Once done, Go to the "SQL" tab, and fill the text area with
{{{
SET GLOBAL log_bin_trust_function_creators = 1;
}}}
Then click "Go".

Now, open the file located at "C:\Program Files\Wamp\www\gelbooru\config.php" with a basic text editor.

Find the line :
{{{
$mysql_pass = "test";
}}}
And replace it by
{{{
$mysql_pass = "";
}}}
Replace
{{{
$mysql_db = "asdf";
}}}
By
{{{
$mysql_db = "gelbooru";
}}}
Replace
{{{
$site_url = "http://127.0.0.1/branches/0.1.10/0.1.10/";
}}}
By
{{{
$site_url = "http://localhost/gelbooru";
}}}
And finally replace
{{{
$site_url3 = "Default Booru";
}}}
By (you can change "Localbooru" by the name of your booru)
{{{
$site_url2 = $site_url3 = "Localbooru";
}}}

Now, go to [http://localhost/gelbooru/install/ http://localhost/gelbooru/install/] and register your admin account.

The installation is finished! You can now use your booru going [http://localhost/gelbooru/ here]. If you run into errors after adding images, click on the WAMP icon on the system tray, go to "PHP > PHP settings" and uncheck "display errors".



= Grabber =

Launch Grabber, then open the options window and go to the "Commands" part. Set it to those values:

Initialization
{{{
"C:\Program Files\Wamp\bin\mysql\mysql5.5.8\bin\mysql.exe" --user=root --password= gelbooru
}}}
Image (with initialization)
{{{
INSERT INTO posts(creation_date, hash, image, height, width, ext, rating, tags, directory, active_date) VALUES(NOW(), "%md5%", "%md5%.%ext%", %height%, %width%, ".%ext%", "%rating%", " %all% ", "1", "20110619"); UPDATE post_count SET pcount=pcount+1 WHERE access_key="posts";
}}}
Tag (with initialization)
{{{
INSERT INTO tag_index(tag, index_count) VALUES("%tag%", 1) ON DUPLICATE KEY UPDATE index_count = index_count+1;
}}}
Image
{{{
C:\Windows\System32\cmd.exe /C copy "%path%" "C:\Program Files\Wamp\www\gelbooru\images\1\%md5%.%ext%"
}}}
On Windows Vista and Windows 7, this command just won't work, unless you started Grabber with administrator rights, since Program Files is a protected folder.

So you can do two things:
  * Start Grabber with administrator rights.
  * Configure wamp and move the www folder to another location.
Let's explain the second solution, which is the best one. Move your gelbooru folder somewhere else, for example to "C:\Users\Bionus\Documents\www\gelbooru". Then, click on the WAMP icon in the system stray, then go to the Apache menu and click "httpd.conf". Into this file, look for "C:\Program Files\Wamp\www" and replace it with "C:\Users\Bionus\Documents\www" (for example). You should find it two times. Then, save the file. Click on the WAMP icon and restart all services. Now, you must also change the Image command, and replace "C:\Program Files\Wamp\www\gelbooru" to "C:\Users\Bionus\Documents\www\gelbooru" (for example).

Now, every time you save an image, a copy will be created in your local booru!



= Thumbnail issue =

If you test, you'll see that it doesn't works totally. In fact, no thumbnail is generated when doing this. Just visit [http://localhost/gelbooru/thumbs_fix.php http://localhost/gelbooru/thumbs_fix.php] to fix this. Note that you must be logged in as administrator in gelbooru to do this.